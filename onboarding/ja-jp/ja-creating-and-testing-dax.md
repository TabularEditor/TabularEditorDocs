# メジャーや他の計算オブジェクトを追加する

Tabular Editor 2.xが2017年初頭にリリースされて以来、メジャー間のDAX式をすばやく修正する機能は、常にツールのもっとも人気のある機能でした。戻る/進むナビゲーション、コピー/ペースト操作、DAX依存性の視覚化、アンドゥ/リドゥのサポートと組み合わせて、このツールは常に、複数の小さな変更を素早く行う能力が重要である、大規模で複雑なデータモデルを扱う人にとって好ましい選択肢となってきました。

この点で、Tabular Editor 2.xのユーザーからの唯一の不満は、DAXコードアシスト機能（時に「IntelliSense」と呼ばれる）がないことでした。とくにDAXに100％精通しているわけではない場合（そうである人はほとんどいません！）、DAXコードエディターが構文や関数パラメーターなどを覚えるのを助けてくれるのは非常に便利です。

これはすべて、Tabular Editor 3にある新しいDAXコードエディターで対処されます。

![複雑なDAX式の編集](../../images/dax-editor-screenshot.png)

この資料では、メジャーおよびその他の計算オブジェクトを作成する方法、およびこれらのオブジェクトのDAX式を変更する方法について説明します。DAXコード・エディターの多くの機能の詳細については、<xref:dax-editor> を参照してください。

## メジャーの追加

モデルに [いくつかのテーブルをインポート](ja-importing-tables-data-modeling.md) して [テーブル間のリレーションシップを作成](ja-importing-tables-data-modeling.md) したら、次はビジネス・ロジックを含むいくつかの明示的メジャーを追加する番です。

> [!TIP］
> 技術的には、Power BI レポートでデータを視覚化する前に、明示的なメジャーをモデルに追加する必要はありません。しかし、MDXベースのクライアントツール（ExcelやTabular Editor 3のPivot Gridなど）では明示的なメジャーが必要なため、常に追加しておくことがベストプラクティスです。また、[Calculation Groups](https://docs.microsoft.com/en-us/analysis-services/tabular-models/calculation-groups?view=asallproducts-allversions) は明示的なメジャーにのみ適用されます。

Tabular Editorを使用して新しいメジャーを追加するには、メジャーを追加するテーブルを右クリックし、**Create > Measure** (ALT+1) を選択します。

![新しいメジャーの追加](../../images/adding-new-measure.png)

新しいメジャーを追加すると、そのメジャーの名前を編集できるようになります。メジャーの名前を入力したら、ENTERキーを押します。名前は後で**Properties**ビューで編集するか、**TOM Explorer**でメジャーを選択した状態でF2を押すと、いつでも編集できます。

**Expression Editor** ビューは、メジャーのDAX式を指定するために使用されます。コードを入力すると、DAXエディターによってコードの候補が表示され、構文エラーや意味上のエラーが下線表示されることに注意してください。

メジャーを追加する![DAXエディタ](../../images/add-measure-edit-dax.png)

**Expression Editor** の左上隅にあるドロップダウン・ボックスは、現在選択されているオブジェクトのさまざまなDAXプロパティを切り替えるために使用されます。たとえば、Analysis Servicesの新しいバージョンでは、メジャーは[`Detail Rows Expression`](https://www.sqlbi.com/articles/controlling-drillthrough-in-excel-pivottables-connected-to-power-bi-or-analysis-services/)と同様に `Expression` プロパティを持っています。その他の種類のオブジェクトには、DAXコードを含むさまざまなプロパティがあります。たとえば、[KPI](https://docs.microsoft.com/en-us/analysis-services/tabular-models/kpis-ssas-tabular?view=asallproducts-allversions)には3つの異なるDAXプロパティがあります。Tabular EditorでKPIを追加するには、メジャーを右クリックし、**Create > KPI** を選択します。

[KPIの編集](../../images/editing-kpis.png)を選択します。

メジャーを非表示にする場合は、右クリックして、**Make invisible** (CTRL+I) オプションを選択するだけです。同様に、**Make visible** (CTRL+U) オプションを選択すると、メジャーを非表示にできます。

## その他のメジャーのプロパティ

`Name`, `Expression`, `Hidden` プロパティに加えて、**Properties** ビューを使用して、**TOM Explorer** で現在選択されているオブジェクトのすべてのプロパティの値を確認および編集できます。メジャーでは、たとえばここで `Format String` を設定できます。詳しくは、[プロパティビュー](xref:properties-view)を参照してください。

## 計算されたカラムを追加する

計算されたカラムを追加するには、カラムを追加したいテーブルを右クリックし、 **Create > Calculated Column** (ALT+2)を選択します。列の名前を付け、上記のメジャーの場合と同様に、**式エディター** を使用してそのDAX式を編集します。

> [重要] このオプションはデフォルトでは使用できません。
> Power BI Desktop モデルに接続している場合、このオプションはデフォルトでは使用できません。これは、[Power BI Desktop がサポートする外部ツールの制限](xref:desktop-limitations) に起因するものです。詳しくはリンクをクリックしてください。

> [!注意]を参照してください。
> 計算列の DAX 式が変更された場合、その列をレポートで使用するには、その列が存在するテーブルをリフレッシュする必要があります。詳しくは <xref:refresh-preview-query#refreshing-data> を参照してください。

## 計算されたテーブルの追加

計算テーブルを追加するには、モデルまたは "Tables"フォルダーを右クリックし、**Create > Calculated Table** (ALT+6)を選択します。テーブルに名前を付け、上記のメジャーの場合と同様に、**式エディター** を使用してそのDAX式を編集します。DAX式を変更すると、テーブルの列が自動的に変更されることに注意してください。他のDAX式がテーブルを参照する場合、または列が階層構造で使用される場合、これはカスケード効果を引き起こす可能性があります。

> [!重要] このオプションはデフォルトでは使用できません。
> Power BI Desktop モデルに接続している場合、このオプションはデフォルトでは使用できません。これは、[外部ツールの Power BI Desktop サポートの制限](xref:desktop-limitations) に起因するものです。詳しくはリンクをクリックしてください。

> [!注意]を参照してください。
> 計算テーブルの DAX 式が変更された場合、そのテーブルをレポートで使用する前にリフレッシュする必要があります。詳しくは<xref:refresh-preview-query#refreshing-data>を参照してください。

## 計算グループの追加

[計算グループ](https://docs.microsoft.com/en-us/analysis-services/tabular-models/calculation-groups?view=asallproducts-allversions)を追加するには、モデルまたは「テーブル」フォルダーを右クリックし、**作成 > 計算グループ** (ALT+7)を選択します。計算グループには名前を付けます。また、デフォルトの**Name**列には、別の名前を考えてください。

> [!重要]。
> このオプションは、互換性レベル1500以上のモデルでのみ利用可能です。

計算項目を追加するには、新しく作成した計算グループを右クリックし、**Create > Calculation Item**を選択します。計算項目に名前を付け、上記のメジャーの場合と同様に **Expression Editor** を使用してそのDAX式を編集します。

計算項目は、TOM Explorerでドラッグするか、**Properties** ビューで `Ordinal` プロパティを設定することにより、表示順序を変更できます。

> [!注意]。
> 計算項目が追加、名前変更、または計算グループから削除された場合、計算グループをリフレッシュしてからでないと、レポートで使用することができません。詳しくは<xref:refresh-preview-query#refreshing-data>を参照してください。

## 一般的なモデリング操作

## コピー／ペースト

TOMエクスプローラーのすべてのオブジェクトはTabular Editorでコピー＆ペーストできます。異なるTabular Editorのインスタンス間、そしてTabular Editor 2.xとTabular Editor 3間でもコピー＆ペーストが可能です。おなじみのキーボードショートカットを使用できます。

- 編集 > コピー** (CTRL+C)
- 編集 > カット** (CTRL+X)
- 編集 > 貼り付け** (CTRL+V)

> [!TIP]です。
> あるテーブルを別のテーブルに置き換え、そのテーブルとの既存のリレーションシップをすべて保持したい場合、テーブルをクリップボードにコピーし、TOMエクスプローラで置き換えたいテーブルを選択して貼り付けます。選択したテーブルをクリップボードにあるテーブルと置き換えるかどうか確認するプロンプトが表示されます。

## 元に戻す/やり直し

Tabular Editorのオブジェクトやプロパティに変更が加えられると、その変更履歴が完全に追跡され、加えられたすべての変更を元に戻すことができます。使い慣れたキーボードショートカットを使用できます。

- 編集 > 元に戻す** (CTRL+Z)
- 編集 > やり直し** (CTRL+Y)

> [!注意]。
> Tabular Editor 3のすべてのテキストエディタは、独自の取り消し/やり直し履歴を持つため、カーソルが現在テキストエディタ内にある場合、キーボードショートカットはそのエディタ内で入力の取り消し/やり直しを行います。モデルレベルでのアンドゥ/リドゥを実行するには、**Edit**メニューのオプションを使用するか、ユーザーインターフェイスの他の要素（TOM Explorerなど）をクリックして現在のテキストエディターを無効化することができます。

## ナビゲーション

DAXエディター内のオブジェクト参照にカーソルを合わせた状態で右クリックし、**Go to definition** (F12)を選択すると、そのオブジェクトに素早くジャンプできます。もちろん、TOMエクスプローラーを使用してオブジェクト間を移動することもできます。

**式エディター**の右上にある矢印ボタンを使用すると、訪問したオブジェクト間を素早く行き来できます。

## DAX依存関係

オブジェクト間のDAX依存関係を表示するには、**TOM Explorer**でオブジェクトを選択し、右クリックして**Show dependencies** (SHIFT+F12)を選択します。これにより、選択したオブジェクトの依存関係（両方向）を表示するウィンドウが開きます。このウィンドウでオブジェクトをダブルクリックすると、そのオブジェクトにすばやく移動できます。

Dax Dependencies And Tom Explorer](../../images/dax-dependencies-and-tom-explorer.png)

## フォルダーを表示する

モデルがかなりの数のメジャーを獲得し始めると、表示フォルダーを使用してそれらを整理することが良い習慣となります。Tabular Editorで、ディスプレイ・フォルダーを作成するには、**Properties** ビューで `Display Folder` プロパティを編集するか、またはメジャーを右クリックし**Create > Display Folder** オプションを選択します。

また、ディスプレイフォルダー間でオブジェクトをカット／コピー／ペーストしたり、ドラッグ＆ドロップすることもできます。
